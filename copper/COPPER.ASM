;**************************************************************************
;------------------- Copper Bars by Sarwaz of Mistery ---------------------
;**************************************************************************
STACK SEGMENT STACK
      db 128 dup (?)
STACK ENDS

DATA SEGMENT
     palette db 0,0,0
             db 1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9
             db 10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15
             db 16,16,16,17,17,17,18,18,18,19,19,19,20,20,20,21,21,21
             db 22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27
             db 28,28,28,29,29,29,30,30,30,31,31,31,32,32,32,33,33,33
             db 34,34,34,35,35,35,36,36,36,37,37,37,38,38,38,39,39,39
             db 40,40,40,41,41,41,42,42,42,43,43,43,44,44,44,45,45,45
             db 46,46,46,47,47,47,48,48,48,49,49,49,50,50,50,51,51,51
             db 52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,57,57,57
             db 58,58,58,59,59,59,60,60,60,61,61,61,62,62,62,63,63,63
             db 62,63,63,61,63,63,60,63,63,59,63,63,58,63,63,57,63,63
             db 56,63,63,55,63,63,54,63,63,53,63,63,52,63,63,51,63,63
             db 50,63,63,49,63,63,48,63,63,47,63,63,46,63,63,45,63,63
             db 44,63,63,43,63,63,42,63,63,41,63,63,40,63,63,39,63,63
             db 38,63,63,37,63,63,36,63,63,35,63,63,34,63,63,33,63,63
             db 32,63,63,31,63,63,30,63,63,29,63,63,28,63,63,27,63,63
             db 26,63,63,25,63,63,24,63,63,23,63,63,22,63,63,21,63,63
             db 20,63,63,19,63,63,18,63,63,17,63,63,16,63,63,15,63,63
             db 14,63,63,13,63,63,12,63,63,11,63,63,10,63,63, 9,63,63
             db  8,63,63, 7,63,63, 6,63,63, 5,63,63, 4,63,63, 3,63,63
             db  2,63,63, 1,63,63, 0,63,63, 0,63,63, 0,62,63, 0,61,63
             db  0,60,63, 0,59,63, 0,58,63, 0,57,63, 0,56,63, 0,55,63
             db  0,54,63, 0,53,63, 0,52,63, 0,51,63, 0,50,63, 0,49,63
             db  0,48,63, 0,47,63, 0,46,63, 0,45,63, 0,44,63, 0,43,63
             db  0,42,63, 0,41,63, 0,40,63, 0,39,63, 0,38,63, 0,37,63
             db  0,36,63, 0,35,63, 0,34,63, 0,33,63, 0,32,63, 0,31,63
             db  0,30,63, 0,29,63, 0,28,63, 0,27,63, 0,26,63, 0,25,63
             db  0,24,63, 0,23,63, 0,22,63, 0,21,63, 0,20,63, 0,19,63
             db  0,18,63, 0,17,63, 0,16,63, 0,15,63, 0,14,63, 0,13,63
             db  0,12,63, 0,11,63, 0,10,63, 0, 9,63, 0, 8,63, 0, 7,63
             db  0, 6,63, 0, 5,63, 0, 4,63, 0, 3,63, 0, 2,63, 0, 1,63
             db  0, 0,63, 1, 0,62, 2, 0,61, 3, 0,60, 4, 0,59, 5, 0,58
             db  6, 0,57, 7, 0,56, 8, 0,55, 9, 0,54,10, 0,53,11, 0,52 
             db 12, 0,51,13, 0,50,14, 0,50,15, 0,49,16, 0,48,17, 0,47
             db 18, 0,46,19, 0,45,20, 0,44,21, 0,43,22, 0,42,23, 0,41
             db 24, 0,40,25, 0,39,25, 0,38,26, 0,37,27, 0,37,28, 0,36
             db 29, 0,35,30, 0,34,31, 0,33,32, 0,32,33, 0,31,34, 0,30
             db 35, 0,29,36, 0,28,36, 0,27,37, 0,26,38, 0,25,39, 0,24
             db 40, 0,23,41, 0,22,42, 0,21,43, 0,20,44, 0,19,45, 0,18
             db 46, 0,17,47, 0,16,48, 0,15,49, 0,14,50, 0,14,51, 0,13
             db 52, 0,12,53, 0,11,54, 0,10,55, 0, 9,56, 0, 8,57, 0, 7
             db 58, 0, 6,59, 0, 5,60, 0, 4,61, 0, 3,62, 0, 2,63, 0, 1
             db 63, 1, 1,63, 2, 1,63, 3, 1,63, 4, 1,63, 5, 1,63, 6, 1
             db 63, 7, 1,63, 8, 1,63, 9, 1,63,10, 1,63,11, 1,63,12, 1
             db 63,13, 1,63,14, 1,63,15, 1,63,16, 1,63,17, 1,63,18, 1
             db 63,19, 1,63,20, 1,63,21, 1,63,22, 1,63,23, 1,63,24, 1
             db 63,25, 1,63,26, 1,63,27, 1,63,28, 1,63,29, 1,63,30, 1
             db 63,31, 1,63,32, 1,63,33, 1,63,34, 1,63,35, 1,63,36, 1
             db 63,37, 1,63,38, 1,63,39, 1,63,40, 1,63,41, 1,63,42, 1
             db 63,43, 1,63,44, 1,63,45, 1,63,46, 1,63,47, 1,63,48, 1
             db 63,49, 1,63,50, 1,63,51, 1,63,52, 1,63,53, 1,63,54, 1
             db 63,55, 1,63,56, 1,63,57, 1,63,58, 1,63,59, 1,63,60, 1
             db 63,61, 1,63,62, 1,63,63, 1,62,62, 1,61,61, 1,60,60, 1
             db 59,59, 1,58,58, 1,57,57, 1,56,56, 1,55,55, 1,54,54, 1
             db 53,53, 1,52,52, 1,51,51, 1,50,50, 1,49,49, 1,48,48, 1
             db 47,47, 1,46,46, 1,45,45, 1,44,44, 1,43,43, 1,42,42, 1
             db 41,41, 1,40,40, 1,39,39, 1,38,38, 1,37,37, 1,36,36, 1
             db 35,35, 1,35,35, 1,34,34, 1,33,33, 1,32,32, 1,31,31, 1
             db 30,30, 1,29,29, 1,28,28, 1,27,27, 1,26,26, 1,25,25, 1
             db 24,24, 1,23,23, 1,22,22, 1,21,21, 1,20,20, 1,19,19, 1
             db 18,18, 1,17,17, 1,16,16, 1,15,15, 1,14,14, 1,13,13, 1
             db 12,12, 1,11,11, 1,10,10, 1, 9, 9, 1, 8, 8, 1, 7, 7, 1
             db  6, 6, 1, 5, 5, 1, 4, 4, 1, 3, 3, 1, 2, 2, 1, 1, 1, 1
             db  0, 0, 0




DATA ENDS

CODE SEGMENT
     ASSUME CS:CODE,DS:DATA

main proc
      mov dx,seg DATA
      mov ds,dx
wesc: mov cx,383
      mov si,offset palette ;load in si palette offset!! :)
      call wvr
copp: 
      call whr
      call mp
      dec cx
      jnz copp
      in al,60h
      cmp al,1
      jnz wesc
      call msdos

main endp     


wvr proc
      mov dx,3dah
dwv:  in al,dx 
      test al,8
      jz dwv
      ret
wvr endp

whr proc
      mov dx,3dah
dwh:  in al,dx
      test al,1
      jnz dwh
dwh2: in al,dx      
      test al,1
      jz dwh2
      ret
whr endp

mp proc
          cli                         ; It's quite good 2 disable int. here
          mov       ax,0
          mov       dx,3c8h 
          out       dx,al 
          mov       bx,3              ; 3 times [palette size]
          inc       dx 
          
CSET:     mov       al,[si]           
          out       dx,al 
          inc       si
          dec       bx
          jnz       CSET
          sti
      
      ret
mp endp

msdos proc
      mov ax,4c00h
      int 21h
msdos endp

CODE ENDS
     END main

