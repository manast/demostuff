;********* PLASMA v1.0 ***********
;********* By Sarwaz/Mry *********
;*********************************

;*** Definitions of Constants ***

YEAR      equ '1995'  ;hehe

XRES      equ 320
YRES      equ 200

XWIDTH    equ 150
YWIDTH    equ 75

NFRAMES   equ 512

XPOS      equ (XRES-XWIDTH)/2   ;In the centre of the screen
YPOS      equ (YRES-YWIDTH)/2

;*********************************
;*** DIRECTIVES ***

.286

STACK SEGMENT STACK
          db 100 dup (?)
STACK ENDS

DATA SEGMENT 
palette   db  0, 0, 0, 2, 0, 0, 4, 0, 0, 8, 0, 0,10, 0, 0,12, 0, 0,15, 0, 0
          db 16, 0, 0,18, 0, 0,20, 0, 0,22, 0, 0,24, 0, 0,26, 0, 0,28, 0, 0
          db 30, 0, 0,32, 0, 0,34, 0, 0,36, 0, 0,38, 0, 0,40, 0 ,0,42, 0, 0
          db 44, 0, 0,46, 0, 0,48, 0, 0,50, 0, 0,52, 0, 0,54, 0, 0,56, 0, 0
          db 58, 0, 0,60, 0, 0,63, 0, 0,63, 0, 2,63, 0, 4,63, 0, 6,63, 0, 8
          db 63, 0,10,63, 0,12,63, 0,15,63, 0,17,63, 0,19,63, 0,21,63, 0,23
          db 63, 0,25,63, 0,27,63, 0,29,63, 0,31,63, 0,33,63, 0,36,63, 0,38
          db 63, 0,40,63, 0,42,63, 0,44,63, 0,46,63, 0,48,63, 0,50,63, 0,52
          db 63, 0,54,63, 0,56,63, 0,58,63, 0,60,63, 0,63,60, 0,63,58, 0,63
          db 56, 0,63,54, 0,63,52, 0,63,50, 0,60,45, 0,55,42, 0,52,40, 0,50
          db 38, 0,46,36, 0,43,34, 0,40,32, 0,38,30, 0,36,28, 0,34,26, 0,31
          db 23, 0,28,20, 0,25,15, 0,20,15, 0,20,10, 0,15, 5, 0,10, 0, 0, 5
          db  5, 5, 0,10,10, 0,12,12, 0,14,14, 0,16,16, 0,20,20, 0,22,22, 0
          db 25,25,10,27,27,10,29,29,10,32,32,10,35,35,10,37,37,10,39,39,10
          db 40,40,10,42,42,10,44,44,10,46,46,10,48,48,10,50,50,10,52,52,10
          db 54,54,10,56,56,10,58,58,10,60,60,10,63,63,10,63,60,12,63,58,14
          db 63,56,16,63,54,18,63,54,20,63,52,22,63,50,24,63,48,26,63,46,28
          db 63,44,30,63,42,32,63,40,34,63,38,36,63,36,38,63,34,40,63,32,42
          db 63,30,44,63,28,46,63,26,48,63,24,50,63,22,52,63,20,54,63,18,56
          db 63,16,58,63,14,60,63,10,63,60,10,60,58,10,58,56,10,56,54,10,54
          db 52,10,52,50,10,50,48,10,48,46,10,46,44,10,44,42,10,42,40,10,40
          db 38,10,38,36,10,36,35,10,35,34,10,34,33,10,33,32,10,32,31,10,31
          db 30,10,30,29,10,29,28,10,28,27,10,27,26,10,26,25,10,25,24,10,24
          db 23,10,23,22,10,22,21,10,21,20,10,20,19,10,19,18,10,18,17,10,17
          db 16,10,16,15,10,15,14,10,14,13,10,13,12,10,12,11,10,11,10,10,10
          db  9, 9, 9, 8, 8, 8, 7, 7, 7, 6, 6, 6, 5, 5, 5, 4, 4, 4, 3, 3, 3
          db  2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0


sinuwave  db 20,20,20,21,21,22,22,23,23,24,25,25,26,27,27,28,29,30,30
          db 31,32,33,34,35,35,36,37,37,38,39,39,40,40,41,42,42,43,43
          db 44,44,44,45,45,46,46,46,47,47,47,46,46,45,45,44,43,43,42
          db 41,40,39,38,38,37,36,36,35,35,35,36,36,37,38,38,39,40,41
          db 42,42,43,43,42,41,41,40,39,39,38,37,36,35,35,34,33,32,31
          db 31,30,29,28,27,26,26,25,24,23,23,22,21,21,20,19,18,17,17
          db 16,15,14,13,13,12,11,10,10,11,12,13,13,14,15,16,16,17,18
          db 19,20,20,21,22,22,23,23,23,24,25,25,25,25,24,23,23,22,21
          db 20,19,19,18,17,17,16,16,16,17,17,18,19,19,20,21,22,23,23
          db 24,24,24,25,25,25,26,26,26,26,25,25,25,24,24,23,22,22,21
          db 20,19,19,18,17,16,16,15,14,13,13,12,11,11,10,10,11,12,13
          db 13,14,15,15,16,17,18,19,19,20,20,20,19,19,19,18,18,17,16
          db 15,15,14,14,14,13,13,13,13,14,14,14,15,15,16,17,17,18,19
          db 20,20,19,19,18,18,18,19,19

;This table is a bit lame (it was my brother who put all the values, i said
;hey, im going to calculate them, and he said, brfgr bu bu, i do! he!, bu ba)

ycordtab  dw  0,320,640,960,1280,1600,1920,2240,2560,2880,3200,3520
          dw  3840,4160,4480,4800,5120,5440,5760,6080,6400,6720,7040
          dw  7360,7680,8000,8320,8640,8960,9280,9600,9920,10240,10560
          dw  10880,11200,11520,11840,12160,12480,12800,13120,13440
          dw  13760,14080,14400,14720,15040,15360,15680,16000,16320
          dw  16640,16960,17280,17600,17920,18240,18560,18880,19200
          dw  19520,19840,20160,20480,20800,21120,21440,21760,22080
          dw  22400,22720,23040,23360,23680,24000,24320,24640,24960
          dw  25280,25600,25920,26240,26560,26880,27200,27520,27840
          dw  28160,28480,28800,29120,29440,29760,30080,30400,30720
          dw  31040,31360,31680,32000,32320,32640,32960,33280,33600
          dw  33920,34240,34560,34880,35200,35520,35840,36160,36480
          dw  36800,37120,37440,37760,38080,38400,38720,39040,39360
          dw  39680,40000,40320,40640,40960,41280,41600,41920,42240
          dw  42560,42880,43200,43520,43840,44160,44480,44800,45120
          dw  45440,45760,46080,46400,46720,47040,47360,47680,48000
          dw  48320,48640,48960,49280,49600,49920,50240,50560,50880
          dw  51200,51520,51840,52160,52480,52800,53120,53440,53760
          dw  54080,54400,54720,55040,55360,55680,56000,56320,56640
          dw  56960,57280,57600,57920,58240,58560,58880,59200,59520
          dw  59840,60160,60480,60800,61120,61440,61760,62080,62400
          dw  62720,63040,63360,63680

sumcolor  db  0

DATA ENDS

CODE SEGMENT
          ASSUME CS:CODE,DS:DATA,SS:STACK

                    
wvr MACRO  ;The wait for vertical retrace macro
          mov dx,3dah
dwait:    in al,dx
          test al,8
          jz dwait
          ENDM


inicio:   mov ax,13h                   ; We initialize the video
          int 10h
          mov ax,SEG DATA              ; Andwe put the Data seg on ds
          mov ds,ax
          xor si,si
          xor ax,ax         ; Here we set the palette
          mov dx,3c8h
          out dx,al
          inc dx
pal:      
          mov al,palette[si]
          out dx,al
          mov al,palette[si+1]
          out dx,al
          mov al,palette[si+2]
          out dx,al
          add si,3
          cmp si,567
          jnz pal
                        ;yeah lets begin with the plasma
          mov ax,0a000h
          mov es,ax
start:    mov dx,NFRAMES  ;Number of frames
          call plasma
          in al,60h
          dec al
          jnz start
          
          include exit.asm



plasma PROC
frames:
          mov cx,YWIDTH
bucley:   
          mov si,cx
          add si,dx
          and si,255
          mov al,sinuwave[si]
          mov si,dx
          shr si,1  ;si=si*2
          add si,cx
          and si,255  ;eat this cent!
          add al,sinuwave[si]
          mov sumcolor,al
          mov di,XWIDTH
buclex:   
          mov si,cx
          add si,YPOS
          shl si,1
          mov ax,ycordtab[si]
          add ax,di
          add ax,XPOS
          mov bx,ax
          mov si,di
          add si,dx
          and si,255
          mov al,sumcolor
          add al,sinuwave[si]
          mov si,dx
          shr si,1
          add si,di
          and si,255
          add al,sinuwave[si]
          mov es:[bx],al
          dec di
          jnz buclex
          loop bucley
          dec dx
          jnz frames
          ret
plasma ENDP          
          
CODE ENDS

END  inicio
